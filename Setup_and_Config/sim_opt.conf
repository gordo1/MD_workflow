##############################################################################
## Namd configuration file.                                         
##############################################################################
# Generic equilibration NAMD script                      m.kuiper June 2012
#
#- this is an example configuration file designed for the equilibration 
#  of a molecular system within namd to be invoked from the "sbatch_start"
#  script.  At the completion of the equilibration run the sbatch script will 
#  call "sbatch_production" which will then execute the production script 
#  for a specified number of times.   
#  More details in README_namd.txt
#
##############################################################################
## Input Parameters:                                            
##  - adjust the "change_me" to point to your pdb and psf files in InputFiles/            
##  - also adjust the cell dimensions to match your simulation under the  
##    "Periodic Boundary Conditions"  section
##  - adjust settings under "Constant Pressure Control" for your simulation.
##############################################################################

set structure       ../../InputFiles/example.psf
set coordinates     ../../InputFiles/example.pdb

structure           $structure
coordinates         $coordinates
outputName          generic_optimization

firsttimestep       0
set Temp  	        310
temperature 	      $Temp

##############################################################################
## Simulation Parameters:
##############################################################################

## Parameters ----------------------------------------------------------------
##  -make sure to use the right parameter set!

paraTypeCharmm	on
parameters  	../../InputFiles/Parameters/par_all27_prot_na.prm
# parameters  	../../InputFiles/Parameters/par_all36_prot.prm
# parameters  	../../InputFiles/Parameters/par_all36_na.prm
#parameters  	../../InputFiles/Parameters/par_all36_lipid.prm
#parameters  	../../InputFiles/Parameters/par_all36_carb.prm
#parameters  	../../InputFiles/Parameters/par_all36_water_ions.prm

## Additional constraints: --------------------------------------------------
#  -can use this section to constrain various parts of the simulation, -for 
#  example protein backbone, with either harmonic constraints or fixed atoms.
#  - make sure to assign a non-zero values to the B column of the pdb file an uncomment the 
#  appropriate section.

#constraints         on 
#consexp             2
#consref             $coordinates
#conskfile           $coordinates
#conskcol            B  ;# set constrained atoms 
#constraintScaling   0.5

#fixedAtoms          on
#fixedAtomsFile      ../../InputFiles/change_me.pdb 
#fixedAtomsCol       B

## Example of interactive molecular dynamics: (Uncommment next 4 lines) 
#IMDon on 
#IMDport 5678
#IMDfreq 10
#IMDwait no

## Example of using colvars:  (make sure to include colvars.in file!) 
#colvars on
#colvarsConfig ../../InputFiles/colvars.in

## Example using extrabonds file: (make sure to include extrabonds.txt file!) 
#extraBonds on
#extraBondsFile  ../../InputFiles/extrabonds.txt

## parameter settings:-------------------------------------------------------
# Force-Field Parameters
exclude        	scaled1-4
1-4scaling    	1.0
cutoff        	12
switching     	on
switchdist     	10
pairlistdist   	14

# Integrator Parameters
timestep            2
rigidBonds          all
nonbondedFreq       1
fullElectFrequency  2  
stepspercycle       10

# Constant Temperature Control
langevin            on
langevinDamping     5  
langevinTemp        $Temp
langevinHydrogen    off 


##  Periodic Boundary Conditions: ----------------------------------------------
# make sure to check that the cell dimensions match your input files! 
cellBasisVector1    48.      0.      0.
cellBasisVector2     0.     48.      0.
cellBasisVector3     0.      0.     48.
cellOrigin           0       0       0
wrapAll             on  ;# wrap water to central cell
wrapWater           on  ;# wrap other molecules too
wrapNearest         on  ;# use for non-rectangular cells

## PME (for full-system periodic electrostatics) -------------------------------
PME                 yes
PMEGridSpacing      1.0 

## Constant Pressure Control (variable volume) ---------------------------------
useGroupPressure      yes ;# needed for rigid bonds
useFlexibleCell       no  ;# no for water box, yes for membrane
useConstantArea       no  ;# no for water box, maybe for membrane

langevinPiston        on
langevinPistonTarget  1.01325 ;# pressure in bar -> 1 atm
langevinPistonPeriod  100.  ;# oscillation period around 100 fs
langevinPistonDecay   50. ;# oscillation decay time of 50 fs
langevinPistonTemp    $Temp ;# coupled to heat bath

## Output settings: -----------------------------------------------------------
restartfreq         50000 
dcdfreq             10000
xstFreq             10000
outputEnergies      10000
outputPressure      10000
outputTiming        10000

###############################################################################
## Execution script:                       
###############################################################################

minimize          5000
reinitvels        $Temp

# Constraint scaling for equilibration
set constraint_scale   8
while {$constraint_scale >= 2} {
  constraintScaling $constraint_scale
  run 10000 ;# 20 ps each step
  set constraint_scale [expr {double($constraint_scale/2)}]  ;# scale the constraint by factor of .5
}
reinitvels

run               50000 
